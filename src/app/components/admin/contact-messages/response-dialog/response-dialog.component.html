<h2 mat-dialog-title>
  {{readonly ? 'Détails du message' : (data.responded ? 'Réponse envoyée' : 'Répondre au message')}}
</h2>

<mat-dialog-content>
  <div class="message-details">
    <div class="detail-row">
      <strong>De :</strong>
      <span>{{data.name}} ({{data.email}})</span>
    </div>
    <div class="detail-row">
      <strong>Date :</strong>
      <span>{{data.timestamp | date:'dd/MM/yyyy HH:mm'}}</span>
    </div>
    <div class="detail-row">
      <strong>Sujet :</strong>
      <span>{{data.subject}}</span>
    </div>
    <div class="message-content">
      <strong>Message :</strong>
      <p>{{data.message}}</p>
    </div>
  </div>

  <form *ngIf="!readonly || data.responded" [formGroup]="responseForm" (ngSubmit)="onSubmit()">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{readonly ? 'Réponse envoyée' : 'Votre réponse'}}</mat-label>
      <textarea matInput
                formControlName="response"
                rows="6"
                placeholder="Écrivez votre réponse ici..."></textarea>
      <mat-error *ngIf="responseForm.get('response')?.errors?.['required']">
        La réponse est requise
      </mat-error>
      <mat-error *ngIf="responseForm.get('response')?.errors?.['minlength']">
        La réponse doit contenir au moins 10 caractères
      </mat-error>
    </mat-form-field>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">
    {{readonly ? 'Fermer' : 'Annuler'}}
  </button>
  <button *ngIf="!readonly"
          mat-raised-button
          color="primary"
          (click)="onSubmit()"
          [disabled]="!responseForm.valid">
    Envoyer la réponse
  </button>
</mat-dialog-actions> 